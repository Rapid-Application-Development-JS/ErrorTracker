!function(e,t){"function"==typeof define&&define.amd?define(function(){return e.ErrorTracker=t()}):"object"==typeof module&&module.exports?module.exports=e.ErrorTracker=t():e.ErrorTracker=t()}(this,function(){function e(e){function t(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function n(e){var t="onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest,n=new t;n.open("POST",c.url,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){200===n.status?(console.info("Error log has sended to service",a),s.clearLog()):console.error("Error: cant send log to service",a)},n.send(e)}function r(){var e,t,n=Object.keys(s.EVENTS.DOMEventTypes),r=[];for(e=0;e<n.length;e++)r=r.concat(s.EVENTS.DOMEventTypes[n[e]]);for(r=s.arrayUnique(r),e=r.length-1;e>=0;e--)t=r[e],document.addEventListener(t,i,!0)}function o(){var e,t,n=Object.keys(s.EVENTS.DOMEventTypes),r=[];for(e=0;e<n.length;e++)r=r.concat(s.EVENTS.DOMEventTypes[n[e]]);for(r=s.arrayUnique(r),e=r.length-1;e>=0;e--)t=r[e],document.removeEventListener(t,i,!0)}var i,s=this,a="_#_ignog_log_#_",u=[],l=[];this.version="1.0.0";var c=t({allowConsoleLogEvent:!0,allowTimerLogEvent:!0,url:void 0,onError:function(){}},e);this.SENDERS={window:"window",console:"console",xhr:"xhr",tracker:"tracker"},this.EVENTS={maxEventStackLength:50,console:"console",xhr:"xhr",timer:"timer",listener:"custom EventListener",DOM:"DOM",DOMEventTypes:{_any:["load","drop","paste","play","pageshow","hashchange","pointerup","pointerdown","pointercancel","touchstart","touchend","touchcancel"],button:["click","dblclick"],input:["blur"],textarea:["blur"],form:["submit","reset"]},EventListenerEliminations:["scroll","wheel","drag","mousemove","mouseover","mouseout","mouseleave","mouseenter","touchmove","mousewheel","input","keydown","keypress","keyup","hold","fling","longtap","tap","doubletap"]},this.eventStack={main:u},this.setOnErrorCallback=function(e){c.onError=e},this.isAllowConsoleLogEvent=function(){return c.allowConsoleLogEvent},this.setAllowConsoleLogEvent=function(e){c.allowConsoleLogEvent=e},this.isAllowTimerLogEvent=function(){return c.allowTimerLogEvent},this.setAllowTimerLogEvent=function(e){c.allowTimerLogEvent=e},this.getIgnoredCustomEventsArray=function(){return s.EVENTS.EventListenerEliminations},this.setIgnoredCustomEventsArray=function(e){s.EVENTS.EventListenerEliminations=e},this.getDOMEvents=function(){for(var e={},t=Object.keys(s.EVENTS.DOMEventTypes),n=0;n<t.length;n++)e[t[n]]=s.EVENTS.DOMEventTypes[t[n]].slice();return e},this.applyDOMEvents=function(e){o(),s.EVENTS.DOMEventTypes={};for(var t=Object.keys(e),n=0;n<t.length;n++)try{s.EVENTS.DOMEventTypes[t[n]]=e[t[n]].slice()}catch(e){s.fault(e)}r()},i=function(e){var t,n;try{t=s.elementForEvent(e),t&&(n=s.EVENTS.DOMEventTypes[t.tagName.toLowerCase()],n&&(n=n.concat(s.EVENTS.DOMEventTypes._any),n&&s.arrayContains(n,e.type)&&s.scheduleEvent(s.EVENTS.DOM,{target:s.serializeElement(t),type:e.type})))}catch(e){s.fault(e)}}.bind(s),this.createNewEventBlock=function(e){e=e||"block "+(Object.keys(this.eventStack).length+1),u=[],this.eventStack[e]=u},this.clearLog=function(){u=[],l=[],s.eventStack={main:u}},this.addCustomEvent=function(e){e=e||{},e.type=e.type||"custom event",e.eventId=e.eventId||l.length+1,l.push(this.scheduleEvent("user",e))},this.printLog=function(){c.allowConsoleLogEvent?console.info(JSON.stringify(s.eventStack,null,4),a):console.info(JSON.stringify(s.eventStack,null,4))},this.fault=function(e){try{this.addError(this.SENDERS.tracker,e)}catch(e){}},this.addError=function(e,t){t.sender=e,t.timestamp=this.isoNow(),t.sessionID=this.sessionID,t.eventsStack=s.eventStack,window.performance&&window.performance.memory&&(t.memoryInfo=window.performance.memory),t.enviroment=this.environmentInfo(),setTimeout(function(){if(t.url!==c.url){var e=s.serializeError(t);c.onError&&c.onError(e),n(e)}},500)},this.scheduleEvent=function(e,t){return t.eventSender=e,t.time=this.isoNow(),u.push(t),u.length>this.EVENTS.maxEventStackLength&&u.shift(),t},this.wrapGlobalErrors=function(){window.onerror=function(e,t,n,r,o){try{o=o||{},o.message=o.message||s.serialize(e),o.file=o.file||s.serialize(t),o.line=o.line||parseInt(n,10)||null,o.column=o.column||parseInt(r,10)||null,s.addError(s.SENDERS.window,o)}catch(e){s.fault(e)}}},this.wrapConsole=function(){var e,t,n=["log","debug","info","warn","error"];for(e=n.length-1;e>=0;e--)t=n[e],this.hasMethod(console,t)&&!function(e){var t=console[e];console[e]=function(){if(c.allowConsoleLogEvent)try{if(arguments.length>1||arguments[1]===a)return arguments.length=1,void t.apply(this,arguments);t.apply(this,arguments),"error"===e?s.addError(s.SENDERS.console,new Error(arguments[0])):s.scheduleEvent(s.EVENTS.console,{level:e,args:s.serialize(arguments)})}catch(e){s.fault(e)}else t.apply(this,arguments)}}(t)},this.wrapNetwork=function(){function e(e){e.errorTrackingInfo&&(e.errorTrackingInfo.statusCode=1223==e.status?204:e.status,e.errorTrackingInfo.statusText=1223==e.status?"No Content":e.statusText,s.scheduleEvent(s.EVENTS.xhr,e.errorTrackingInfo))}function t(e){e.errorTrackingInfo&&e.status>=400&&1223!=e.status&&s.addError(s.SENDERS.xhr,{status:e.status,statusText:e.statusText,method:e.errorTrackingInfo.method,url:e.errorTrackingInfo.url})}function n(n){window.ProgressEvent&&n.addEventListener&&n.addEventListener("readystatechange",function(){4===n.readyState&&e(n)},!0),n.addEventListener?n.addEventListener("load",function(){e(n),t(n)},!0):setTimeout(function(){try{var r=n.onload,o=n.onerror;n.onload=function(){e(n),t(n),"function"==typeof r&&r.apply(n,arguments)},n.onerror=function(){e(n),t(n),"function"==typeof o&&o.apply(n,arguments)}}catch(e){s.fault(e)}},0)}var r=XMLHttpRequest.prototype.send,o=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){return t.indexOf("localhost:0")<0&&(this.errorTrackingInfo={method:e,url:t}),o.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){if(this.errorTrackingInfo)try{this.errorTrackingInfo.sendTime=s.isoNow(),n(this)}catch(e){s.fault(e)}return r.apply(this,arguments)}},this.wrapTimers=function(){function e(e){var t=window[e];window[e]=function(){if(c.allowTimerLogEvent)try{s.scheduleEvent(s.EVENTS.timer,{type:e,params:s.serialize(Array.prototype.slice.call(arguments,1))})}catch(e){s.fault(e)}t.apply(this,arguments)}}e("setTimeout"),e("setInterval")},this.removeListener=function(){o()},this.wrapCustomEventListeners=function(){function e(e,t){var n=e[t];e[t]=function(){var e;try{arguments.length>0&&!s.arrayContains(s.EVENTS.EventListenerEliminations,arguments[0])&&(e=arguments[1],"function"==typeof e&&(arguments[1]=function(t){e.apply(this,arguments),s.scheduleEvent(s.EVENTS.listener,{target:s.serializeElement(s.elementForEvent(t)),type:t.type})}))}catch(e){s.fault(e)}n.apply(this,arguments)}}e(Element.prototype,"addEventListener")},this.elementForEvent=function(e){return e.target||document.elementFromPoint(e.clientX,e.clientY)},this.serializeError=function(e){var t=e.stack||e.stacktrace;return t&&(e._stack=t),JSON.stringify(e,null,4)},this.serialize=function(e){var t="";if("undefined"==typeof e)return"undefined";try{t=String(e),("[object Object]"===t||"[object Arguments]"===t)&&(t=JSON.stringify(e))}catch(e){}return t},this.serializeElement=function(e){function t(e){var t,n={};for(t=0;t<e.attributes.length;t++)"value"!==e.attributes[t].name.toLowerCase()&&(n[e.attributes[t].name]=e.attributes[t].value);return n}function n(e){return"string"==typeof e?""==e?"":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(e)?"{type: email, length: "+e.length+"}":/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(e)?"{type: date, length: "+e.length+"}":/^\s*$/.test(e)?"{type: whitespace, length: "+e.length+"}":/^\d*$/.test(e)?"{type: numeric, length: "+e.length+"}":/^[a-zA-Z]*$/.test(e)?"{type: alpha, length: "+e.length+"}":/^[a-zA-Z0-9]*$/.test(e)?"{type: alphanumeric, length: "+e.length+"}":"{type: characters, length: "+e.length+"}":s.serialize(e)}function r(e){var t;if(e.multiple){for(t=0;t<e.options.length;t++)if(e.options[t].selected)return e.options[t].value}else if(e.selectedIndex>=0&&e.options[e.selectedIndex])return e.options[e.selectedIndex].value;return null}var o;return e?(o={tag:e.tagName.toLowerCase(),attributes:t(e)},"select"===o.tag?o.value=r(e):e.hasOwnProperty("value")&&(o.value=n(e.value)),"input"!==o.tag&&"textarea"!==o.tag&&(e.textContent?o.text=e.textContent:e.innerText&&(o.text=e.innerText)),o):null},this.createGUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},this.isoNow=function(){function e(e){function t(e){return 10>e?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var t=new Date;return t.toISOString?t.toISOString():e(t)},this.hasMethod=function(e,t){try{return"function"==typeof e[t]&&!!e[t]}catch(e){return!1}},this.arrayUnique=function(e){for(var t=e.concat(),n=0;n<t.length;++n)for(var r=n+1;r<t.length;++r)t[n]===t[r]&&t.splice(r--,1);return t},this.arrayContains=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},this.environmentInfo=function(){var e,t={};window.jQuery&&(jQuery.fn&&jQuery.fn.jquery&&(t.jQuery=jQuery.fn.jquery),jQuery.ui&&jQuery.ui.version&&(t.jQueryUI=jQuery.ui.version)),window.angular&&angular.version&&angular.version.full&&(t.angular=angular.version.full);for(e in window)if("webkitStorageInfo"!==e&&"webkitIndexedDB"!==e)try{if(window[e]){var n=window[e].version||window[e].Version||window[e].VERSION;("string"==typeof n||"number"==typeof n)&&(t[e]=n)}}catch(e){}t.scripts=[];for(var e=0;e!=document.scripts.length;e++)t.scripts[e]=document.scripts[e].outerHTML;return t.userAgent=navigator.userAgent,t.viewportHeight=document.documentElement.clientHeight,t.viewportWidth=document.documentElement.clientWidth,t},this.sessionID=this.createGUID(),this.wrapGlobalErrors(),this.wrapConsole(),this.wrapNetwork(),r(),this.wrapCustomEventListeners(),this.wrapTimers(),this.clearLog()}return e});
//# sourceMappingURL=release/errortracker.min.js.map