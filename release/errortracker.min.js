!function(t,e){"function"==typeof define&&define.amd?define(function(){return t.ErrorTracker=e()}):"object"==typeof module&&module.exports?module.exports=t.ErrorTracker=e():t.ErrorTracker=e()}(this,function(){function t(t){function e(t,e){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function n(t){var e="onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest,n=new e;n.open("POST",c.url,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=function(){200===n.status?(console.info("Error log has sended to service",a),s.clearLog()):console.error("Error: cant send log to service",a)},n.send(t)}function r(){var t,e,n=Object.keys(s.EVENTS.DOMEventTypes),r=[];for(t=0;t<n.length;t++)r=r.concat(s.EVENTS.DOMEventTypes[n[t]]);for(r=s.arrayUnique(r),t=r.length-1;t>=0;t--)e=r[t],document.addEventListener(e,i,!0)}function o(){var t,e,n=Object.keys(s.EVENTS.DOMEventTypes),r=[];for(t=0;t<n.length;t++)r=r.concat(s.EVENTS.DOMEventTypes[n[t]]);for(r=s.arrayUnique(r),t=r.length-1;t>=0;t--)e=r[t],document.removeEventListener(e,i,!0)}var i,s=this,a="_#_ignog_log_#_",u=[],l=[];this.version="1.0.0";var c=e({allowConsoleLogEvent:!0,allowTimerLogEvent:!0,url:void 0,onError:function(){}},t);this.SENDERS={window:"window",console:"console",xhr:"xhr",tracker:"tracker"},this.EVENTS={maxEventStackLength:50,console:"console",xhr:"xhr",timer:"timer",listener:"custom EventListener",DOM:"DOM",DOMEventTypes:{_any:["load","drop","paste","play","pageshow","hashchange","pointerup","pointerdown","pointercancel","touchstart","touchend","touchcancel"],button:["click","dblclick"],input:["blur"],textarea:["blur"],form:["submit","reset"]},EventListenerEliminations:["scroll","wheel","drag","mousemove","mouseover","mouseout","mouseleave","mouseenter","touchmove","mousewheel","input","keydown","keypress","keyup","hold","fling","longtap","tap","doubletap"]},this.eventStack={main:u},this.setOnErrorCallback=function(t){c.onError=t},this.isAllowConsoleLogEvent=function(){return c.allowConsoleLogEvent},this.setAllowConsoleLogEvent=function(t){c.allowConsoleLogEvent=t},this.isAllowTimerLogEvent=function(){return c.allowTimerLogEvent},this.setAllowTimerLogEvent=function(t){c.allowTimerLogEvent=t},this.getIgnoredCustomEventsArray=function(){return s.EVENTS.EventListenerEliminations},this.setIgnoredCustomEventsArray=function(t){s.EVENTS.EventListenerEliminations=t},this.getDOMEvents=function(){for(var t={},e=Object.keys(s.EVENTS.DOMEventTypes),n=0;n<e.length;n++)t[e[n]]=s.EVENTS.DOMEventTypes[e[n]].slice();return t},this.applyDOMEvents=function(t){o(),s.EVENTS.DOMEventTypes={};for(var e=Object.keys(t),n=0;n<e.length;n++)try{s.EVENTS.DOMEventTypes[e[n]]=t[e[n]].slice()}catch(t){s.fault(t)}r()},i=function(t){var e,n;try{e=s.elementForEvent(t),e&&(n=s.EVENTS.DOMEventTypes[e.tagName.toLowerCase()],n&&(n=n.concat(s.EVENTS.DOMEventTypes._any),n&&s.arrayContains(n,t.type)&&s.scheduleEvent(s.EVENTS.DOM,{target:s.serializeElement(e),type:t.type})))}catch(t){s.fault(t)}}.bind(s),this.createNewEventBlock=function(t){t=t||"block "+(Object.keys(this.eventStack).length+1),u=[],this.eventStack[t]=u},this.clearLog=function(){u=[],l=[],s.eventStack={main:u}},this.addCustomEvent=function(t){t=t||{},t.type=t.type||"custom event",t.eventId=t.eventId||l.length+1,l.push(this.scheduleEvent("user",t))},this.printLog=function(){c.allowConsoleLogEvent?console.info(JSON.stringify(s.eventStack,null,4),a):console.info(JSON.stringify(s.eventStack,null,4))},this.fault=function(t){try{this.addError(this.SENDERS.tracker,t)}catch(t){}},this.addError=function(t,e){e.sender=t,e.timestamp=this.isoNow(),e.sessionID=this.sessionID,e.eventsStack=s.eventStack,window.performance&&window.performance.memory&&(e.memoryInfo=window.performance.memory),e.enviroment=this.environmentInfo(),setTimeout(function(){if(e.url!==c.url){var t=s.serializeError(e);c.onError&&c.onError(t),n(t)}},500)},this.scheduleEvent=function(t,e){return e.eventSender=t,e.time=this.isoNow(),u.push(e),u.length>this.EVENTS.maxEventStackLength&&u.shift(),e},this.wrapGlobalErrors=function(){window.onerror=function(t,e,n,r,o){try{o=o||{},o.message=o.message||s.serialize(t),o.file=o.file||s.serialize(e),o.line=o.line||parseInt(n,10)||null,o.column=o.column||parseInt(r,10)||null,s.addError(s.SENDERS.window,o)}catch(t){s.fault(t)}}},this.wrapConsole=function(){var t,e,n=["log","debug","info","warn","error"];for(t=n.length-1;t>=0;t--)e=n[t],this.hasMethod(console,e)&&!function(t){var e=console[t];console[t]=function(){if(c.allowConsoleLogEvent)try{if(arguments.length>1||arguments[1]===a)return arguments.length=1,void e.apply(this,arguments);e.apply(this,arguments),"error"===t?s.addError(s.SENDERS.console,new Error(arguments[0])):s.scheduleEvent(s.EVENTS.console,{level:t,args:s.serialize(arguments)})}catch(t){s.fault(t)}else e.apply(this,arguments)}}(e)},this.wrapNetwork=function(){function t(t){t.errorTrackingInfo&&(t.errorTrackingInfo.statusCode=1223==t.status?204:t.status,t.errorTrackingInfo.statusText=1223==t.status?"No Content":t.statusText,s.scheduleEvent(s.EVENTS.xhr,t.errorTrackingInfo))}function e(t){var e;e=0===t.status?"Not connect. Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"Uncaught Error.\n"+t.responseText,s.addError(s.SENDERS.xhr,{status:t.status,statusText:t.statusText||e,errorInfo:t.errorTrackingInfo})}function n(n){window.ProgressEvent&&n.addEventListener&&n.addEventListener("readystatechange",function(){4===n.readyState&&t(n)},!0),n.addEventListener?(n.addEventListener("load",function(){t(n)},!0),n.addEventListener("error",function(){t(n),e(n)},!0),n.addEventListener("abort",function(){t(n),e(n)},!0)):setTimeout(function(){try{var r=n.onload,o=n.onabort,i=n.onerror;n.onload=function(){t(n),e(n),"function"==typeof r&&r.apply(n,arguments)},n.onerror=function(){t(n),e(n),"function"==typeof i&&i.apply(n,arguments)},n.onabort=function(){t(n),e(n),"function"==typeof o&&o.apply(n,arguments)}}catch(t){s.fault(t)}},0)}var r=XMLHttpRequest.prototype.send,o=(XMLHttpRequest.prototype.error,XMLHttpRequest.prototype.open);XMLHttpRequest.prototype.open=function(t,e){return e.indexOf("localhost:0")<0&&(this.errorTrackingInfo={method:t,url:e}),o.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){if(this.errorTrackingInfo)try{this.errorTrackingInfo.sendTime=s.isoNow(),n(this)}catch(t){s.fault(t)}return r.apply(this,arguments)}},this.wrapTimers=function(){function t(t){var e=window[t];window[t]=function(){if(c.allowTimerLogEvent)try{s.scheduleEvent(s.EVENTS.timer,{type:t,params:s.serialize(Array.prototype.slice.call(arguments,1))})}catch(t){s.fault(t)}e.apply(this,arguments)}}t("setTimeout"),t("setInterval")},this.removeListener=function(){o()},this.wrapCustomEventListeners=function(){function t(t,e){var n=t[e];t[e]=function(){var t;try{arguments.length>0&&!s.arrayContains(s.EVENTS.EventListenerEliminations,arguments[0])&&(t=arguments[1],"function"==typeof t&&(arguments[1]=function(e){t.apply(this,arguments),s.scheduleEvent(s.EVENTS.listener,{target:s.serializeElement(s.elementForEvent(e)),type:e.type})}))}catch(t){s.fault(t)}n.apply(this,arguments)}}t(Element.prototype,"addEventListener")},this.elementForEvent=function(t){return t.target||document.elementFromPoint(t.clientX,t.clientY)},this.serializeError=function(t){var e=t.stack||t.stacktrace;return e&&(t._stack=e),JSON.stringify(t,null,4)},this.serialize=function(t){var e="";if("undefined"==typeof t)return"undefined";try{e=String(t),("[object Object]"===e||"[object Arguments]"===e)&&(e=JSON.stringify(t))}catch(t){}return e},this.serializeElement=function(t){function e(t){var e,n={};for(e=0;e<t.attributes.length;e++)"value"!==t.attributes[e].name.toLowerCase()&&(n[t.attributes[e].name]=t.attributes[e].value);return n}function n(t){return"string"==typeof t?""==t?"":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(t)?"{type: email, length: "+t.length+"}":/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(t)?"{type: date, length: "+t.length+"}":/^\s*$/.test(t)?"{type: whitespace, length: "+t.length+"}":/^\d*$/.test(t)?"{type: numeric, length: "+t.length+"}":/^[a-zA-Z]*$/.test(t)?"{type: alpha, length: "+t.length+"}":/^[a-zA-Z0-9]*$/.test(t)?"{type: alphanumeric, length: "+t.length+"}":"{type: characters, length: "+t.length+"}":s.serialize(t)}function r(t){var e;if(t.multiple){for(e=0;e<t.options.length;e++)if(t.options[e].selected)return t.options[e].value}else if(t.selectedIndex>=0&&t.options[t.selectedIndex])return t.options[t.selectedIndex].value;return null}var o;return t?(o={tag:t.tagName.toLowerCase(),attributes:e(t)},"select"===o.tag?o.value=r(t):t.hasOwnProperty("value")&&(o.value=n(t.value)),"input"!==o.tag&&"textarea"!==o.tag&&(t.textContent?o.text=t.textContent:t.innerText&&(o.text=t.innerText)),o):null},this.createGUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.isoNow=function(){function t(t){function e(t){return 10>t?"0"+t:t}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var e=new Date;return e.toISOString?e.toISOString():t(e)},this.hasMethod=function(t,e){try{return"function"==typeof t[e]&&!!t[e]}catch(t){return!1}},this.arrayUnique=function(t){for(var e=t.concat(),n=0;n<e.length;++n)for(var r=n+1;r<e.length;++r)e[n]===e[r]&&e.splice(r--,1);return e},this.arrayContains=function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1},this.environmentInfo=function(){var t,e={};window.jQuery&&(jQuery.fn&&jQuery.fn.jquery&&(e.jQuery=jQuery.fn.jquery),jQuery.ui&&jQuery.ui.version&&(e.jQueryUI=jQuery.ui.version)),window.angular&&angular.version&&angular.version.full&&(e.angular=angular.version.full);for(t in window)if("webkitStorageInfo"!==t&&"webkitIndexedDB"!==t)try{if(window[t]){var n=window[t].version||window[t].Version||window[t].VERSION;("string"==typeof n||"number"==typeof n)&&(e[t]=n)}}catch(t){}e.scripts=[];for(var t=0;t!=document.scripts.length;t++)e.scripts[t]=document.scripts[t].outerHTML;var r=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{type:" Network Information API not Supported"};return e.connectionType=r.type,e.connectionStatus=navigator.onLine,e.userAgent=navigator.userAgent,e.viewportHeight=document.documentElement.clientHeight,e.viewportWidth=document.documentElement.clientWidth,e},this.sessionID=this.createGUID(),this.wrapGlobalErrors(),this.wrapConsole(),this.wrapNetwork(),r(),this.wrapCustomEventListeners(),this.wrapTimers(),this.clearLog()}return t});
//# sourceMappingURL=release/errortracker.min.js.map