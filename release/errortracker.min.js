!function(t,e){"function"==typeof define&&define.amd?define(function(){return t.ErrorTracker=e()}):"object"==typeof module&&module.exports?module.exports=t.ErrorTracker=e():t.ErrorTracker=e()}(this,function(){function t(){var t=this,e="_#_ignog_log_#_",n=[],r=[];this.version="1.0.0",this.SENDERS={window:"window",console:"console",xhr:"xhr",tracker:"tracker"},this.EVENTS={maxEventStackLength:50,console:"console",xhr:"xhr",timer:"timer",listener:"custom EventListener",DOM:"DOM",DOMEventTypes:{_any:["load","drop","paste","play","pageshow","hashchange"],button:["click","dblclick"],input:["blur"],textarea:["blur"],form:["submit","reset"]},EventListenerEliminations:["scroll","wheel","drag","mousemove","mouseover","mouseout","mouseleave","mouseenter","touchmove","mousewheel","input","keydown","keypress","keyup"]},this.eventStack={main:n},this.createNewEventBlock=function(t){t=t||"block "+(Object.keys(this.eventStack).length+1),n=[],this.eventStack[t]=n},this.clearLog=function(){n=[],r=[],t.eventStack={main:n}},this.addCustomEvent=function(t){t=t||{},t.type=t.type||"custom event",t.eventId=t.eventId||r.length+1,r.push(this.scheduleEvent("user",t))},this.printLog=function(){console.info(JSON.stringify(t.eventStack,null,4),e)},this.fault=function(t){try{this.addError(this.SENDERS.tracker,t)}catch(t){}},this.addError=function(e,n){n.sender=e,n.timestamp=this.isoNow(),n.sessionID=this.sessionID,n.eventsStack=t.eventStack,window.performance&&window.performance.memory&&(n.memoryInfo=window.performance.memory),n.enviroment=this.environmentInfo(),this.onError(this.serializeError(n)),this.clearLog()},this.scheduleEvent=function(t,e){return e.eventSender=t,e.time=this.isoNow(),n.push(e),n.length>this.EVENTS.maxEventStackLength&&n.shift(),e},this.wrapGlobalErrors=function(){window.onerror=function(e,n,r,o,i){try{i=i||{},i.message=i.message||t.serialize(e),i.file=i.file||t.serialize(n),i.line=i.line||parseInt(r,10)||null,i.column=i.column||parseInt(o,10)||null,t.addError(t.SENDERS.window,i)}catch(e){t.fault(e)}}},this.wrapConsole=function(){var n,r,o=["log","debug","info","warn","error"];for(n=o.length-1;n>=0;n--)r=o[n],this.hasMethod(console,r)&&!function(n){var r=console[n];console[n]=function(){try{if(arguments.length>1||arguments[1]===e)return arguments.length=1,void r.apply(this,arguments);r.apply(this,arguments),"error"===n?t.addError(t.SENDERS.console,new Error(arguments[0])):t.scheduleEvent(t.EVENTS.console,{level:n,args:t.serialize(arguments)})}catch(e){t.fault(e)}}}(r)},this.wrapNetwork=function(){function e(e){e.errorTrackingInfo&&(e.errorTrackingInfo.statusCode=1223==e.status?204:e.status,e.errorTrackingInfo.statusText=1223==e.status?"No Content":e.statusText,t.scheduleEvent(t.EVENTS.xhr,e.errorTrackingInfo))}function n(e){e.errorTrackingInfo&&e.status>=400&&1223!=e.status&&t.addError(t.SENDERS.xhr,{status:e.status,statusText:e.statusText,method:e.errorTrackingInfo.method,url:e.errorTrackingInfo.url})}function r(r){window.ProgressEvent&&r.addEventListener&&r.addEventListener("readystatechange",function(){4===r.readyState&&e(r)},!0),r.addEventListener?r.addEventListener("load",function(){e(r),n(r)},!0):setTimeout(function(){try{var o=r.onload,i=r.onerror;r.onload=function(){e(r),n(r),"function"==typeof o&&o.apply(r,arguments)},r.onerror=function(){e(r),n(r),"function"==typeof i&&i.apply(r,arguments)}}catch(e){t.fault(e)}},0)}var o=XMLHttpRequest.prototype.send,i=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,e){return e.indexOf("localhost:0")<0&&(this.errorTrackingInfo={method:t,url:e}),i.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){if(this.errorTrackingInfo)try{this.errorTrackingInfo.sendTime=t.isoNow(),r(this)}catch(e){t.fault(e)}return o.apply(this,arguments)}},this.wrapTimers=function(){function e(e){var n=window[e];window[e]=function(){try{t.scheduleEvent(t.EVENTS.timer,{type:e,params:t.serialize(Array.prototype.slice.call(arguments,1))})}catch(e){t.fault(e)}n.apply(this,arguments)}}e("setTimeout"),e("setInterval")},this.wrapDOMEvents=function(){var e,n,r=Object.keys(this.EVENTS.DOMEventTypes),o=[];for(e=0;e<r.length;e++)o=o.concat(this.EVENTS.DOMEventTypes[r[e]]);for(o=this.arrayUnique(o),e=o.length-1;e>=0;e--)n=o[e],function(e){document.addEventListener(e,function(e){var n,r;try{n=t.elementForEvent(e),n&&(r=t.EVENTS.DOMEventTypes[n.tagName.toLowerCase()],r&&(r=r.concat(t.EVENTS.DOMEventTypes._any),r&&t.arrayContains(r,e.type)&&t.scheduleEvent(t.EVENTS.DOM,{target:t.serializeElement(n),type:e.type})))}catch(e){t.fault(e)}},!0)}(n)},this.wrapCustomEventListeners=function(){function e(e,n){var r=e[n];e[n]=function(){var e;try{arguments.length>0&&!t.arrayContains(t.EVENTS.EventListenerEliminations,arguments[0])&&(e=arguments[1],"function"==typeof e&&(arguments[1]=function(n){e.apply(this,arguments),t.scheduleEvent(t.EVENTS.listener,{target:t.serializeElement(t.elementForEvent(n)),type:n.type})}))}catch(e){t.fault(e)}r.apply(this,arguments)}}e(Element.prototype,"addEventListener")},this.elementForEvent=function(t){return t.target||document.elementFromPoint(t.clientX,t.clientY)},this.serializeError=function(t){var e=t.stack||t.stacktrace;return e&&(t._stack=e),JSON.stringify(t,null,4)},this.serialize=function(t){var e="";if("undefined"==typeof t)return"undefined";try{e=String(t),("[object Object]"===e||"[object Arguments]"===e)&&(e=JSON.stringify(t))}catch(t){}return e},this.serializeElement=function(e){function n(t){var e,n={};for(e=0;e<t.attributes.length;e++)"value"!==t.attributes[e].name.toLowerCase()&&(n[t.attributes[e].name]=t.attributes[e].value);return n}function r(e){return"string"==typeof e?""==e?"":/^[a-z0-9!#$%&'*+=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/.test(e)?"email":/^(\d{4}[\/\-](0?[1-9]|1[012])[\/\-]0?[1-9]|[12][0-9]|3[01])$/.test(e)?"date":/^\s*$/.test(e)?"whitespace":/^\d*$/.test(e)?"numeric":/^[a-zA-Z]*$/.test(e)?"alpha":/^[a-zA-Z0-9]*$/.test(e)?"alphanumeric":"characters":t.serialize(e)}function o(t){var e;if(t.multiple){for(e=0;e<t.options.length;e++)if(t.options[e].selected)return t.options[e].value}else if(t.selectedIndex>=0&&t.options[t.selectedIndex])return t.options[t.selectedIndex].value;return null}var i;return e?(i={tag:e.tagName.toLowerCase(),attributes:n(e)},"select"===i.tag?i.value=o(e):e.hasOwnProperty("value")&&(i.value=r(e.value)),"input"!==i.tag&&"textarea"!==i.tag&&(e.textContent?i.text=e.textContent:e.innerText&&(i.text=e.innerText)),i):null},this.createGUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},this.isoNow=function(){function t(t){function e(t){return 10>t?"0"+t:t}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var e=new Date;return e.toISOString?e.toISOString():t(e)},this.hasMethod=function(t,e){try{return"function"==typeof t[e]&&!!t[e]}catch(t){return!1}},this.arrayUnique=function(t){for(var e=t.concat(),n=0;n<e.length;++n)for(var r=n+1;r<e.length;++r)e[n]===e[r]&&e.splice(r--,1);return e},this.arrayContains=function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1},this.environmentInfo=function(){var t,e={};window.jQuery&&(jQuery.fn&&jQuery.fn.jquery&&(e.jQuery=jQuery.fn.jquery),jQuery.ui&&jQuery.ui.version&&(e.jQueryUI=jQuery.ui.version)),window.angular&&angular.version&&angular.version.full&&(e.angular=angular.version.full);for(t in window)if("webkitStorageInfo"!==t&&"webkitIndexedDB"!==t)try{if(window[t]){var n=window[t].version||window[t].Version||window[t].VERSION;("string"==typeof n||"number"==typeof n)&&(e[t]=n)}}catch(t){}return e.userAgent=navigator.userAgent,e.viewportHeight=document.documentElement.clientHeight,e.viewportWidth=document.documentElement.clientWidth,e},this.sessionID=this.createGUID(),this.wrapGlobalErrors(),this.wrapConsole(),this.wrapNetwork(),this.wrapDOMEvents(),this.wrapCustomEventListeners(),this.wrapTimers(),this.clearLog()}return t});
//# sourceMappingURL=release/errortracker.min.js.map